#!/bin/bash

# 定時打卡時間配置
# 作者: Claude Code
# 用途: 集中管理排程時間設定

# ============================
# 簽到時間設定
# ============================
CHECKIN_HOUR=8
CHECKIN_MINUTE=30

# ============================
# 簽退時間設定
# ============================
CHECKOUT_HOUR=17
CHECKOUT_MINUTE=50

# ============================
# 工作日設定
# ============================
# 1=週一, 2=週二, 3=週三, 4=週四, 5=週五, 6=週六, 7=週日
WORKDAYS=(1 2 5)

# ============================
# 輔助函數
# ============================

# 檢查是否為工作日
is_workday() {
    local day_of_week=$(date +%u)  # 1=Monday, 7=Sunday
    for workday in "${WORKDAYS[@]}"; do
        if [[ $day_of_week -eq $workday ]]; then
            return 0
        fi
    done
    return 1
}

# 格式化時間顯示
format_time() {
    printf "%02d:%02d" "$1" "$2"
}

# 取得下一個工作日
get_next_workday() {
    local current_day=${1:-$(date +%u)}  # 預設為今天
    
    # 從明天開始檢查本週剩餘的日子
    for ((day=$current_day+1; day<=7; day++)); do
        for workday in "${WORKDAYS[@]}"; do
            if [[ $day -eq $workday ]]; then
                echo $day
                return 0
            fi
        done
    done
    
    # 如果本週沒有了，從下週一開始檢查
    for ((day=1; day<=7; day++)); do
        for workday in "${WORKDAYS[@]}"; do
            if [[ $day -eq $workday ]]; then
                echo $day
                return 0
            fi
        done
    done
    
    # 理論上不應該到這裡（除非沒有設定任何工作日）
    echo 1
}

# 將數字轉換為星期名稱
day_to_name() {
    case $1 in
        1) echo "週一" ;;
        2) echo "週二" ;;
        3) echo "週三" ;;
        4) echo "週四" ;;
        5) echo "週五" ;;
        6) echo "週六" ;;
        7) echo "週日" ;;
        *) echo "未知" ;;
    esac
}

# 顯示當前配置
show_config() {
    echo "當前時間配置:"
    echo "=============="
    echo "簽到時間: $(format_time $CHECKIN_HOUR $CHECKIN_MINUTE)"
    echo "簽退時間: $(format_time $CHECKOUT_HOUR $CHECKOUT_MINUTE)"
    echo ""
    echo -n "工作日: "
    for day in "${WORKDAYS[@]}"; do
        case $day in
            1) echo -n "週一 " ;;
            2) echo -n "週二 " ;;
            3) echo -n "週三 " ;;
            4) echo -n "週四 " ;;
            5) echo -n "週五 " ;;
            6) echo -n "週六 " ;;
            7) echo -n "週日 " ;;
        esac
    done
    echo
}

# 如果直接執行此配置文件，顯示當前配置
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    show_config
fi