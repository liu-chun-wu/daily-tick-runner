
#!/bin/bash

# 定時打卡時間配置
# 作者: Claude Code
# 用途: 集中管理所有時間相關設定

# ============================
# 簽到時間設定
# ============================
CHECKIN_HOUR=8
CHECKIN_MINUTE=30

# ============================
# 簽退時間設定
# ============================
CHECKOUT_HOUR=18
CHECKOUT_MINUTE=00

# ============================
# 時間窗口設定
# ============================
# 預設窗口大小：前後10分鐘
WINDOW_SIZE_MINUTES=10

# ============================
# 工作日設定
# ============================
# 1=週一, 2=週二, 3=週三, 4=週四, 5=週五, 6=週六, 7=週日
WORKDAYS=(1 2 3 4 5)    # 預設週一到週五

# ============================
# 輔助函數
# ============================

# 檢查是否為工作日
is_workday() {
    local day_of_week=$(date +%u)  # 1=Monday, 7=Sunday
    for workday in "${WORKDAYS[@]}"; do
        if [[ $day_of_week -eq $workday ]]; then
            return 0
        fi
    done
    return 1
}

# 計算時間窗口邊界（以分鐘為單位）
get_window_bounds() {
    local hour=$1
    local minute=$2
    local window_size=${3:-$WINDOW_SIZE_MINUTES}  # 使用配置的窗口大小或指定值
    
    local total_minutes=$((hour * 60 + minute))
    local start=$((total_minutes - window_size))
    local end=$((total_minutes + window_size))
    
    echo "$start $end"
}

# 獲取簽到窗口邊界
get_checkin_window() {
    get_window_bounds $CHECKIN_HOUR $CHECKIN_MINUTE
}

# 獲取簽退窗口邊界
get_checkout_window() {
    get_window_bounds $CHECKOUT_HOUR $CHECKOUT_MINUTE
}


# 格式化時間顯示
format_time() {
    printf "%02d:%02d" "$1" "$2"
}

# 顯示當前配置
show_config() {
    echo "當前時間配置:"
    echo "=============="
    echo "簽到時間: $(format_time $CHECKIN_HOUR $CHECKIN_MINUTE)"
    
    # 計算並顯示簽到窗口
    local checkin_bounds=($(get_checkin_window))
    local checkin_start_time=$(printf "%02d:%02d" $((checkin_bounds[0] / 60)) $((checkin_bounds[0] % 60)))
    local checkin_end_time=$(printf "%02d:%02d" $((checkin_bounds[1] / 60)) $((checkin_bounds[1] % 60)))
    echo "簽到窗口: $checkin_start_time - $checkin_end_time (±${WINDOW_SIZE_MINUTES}分鐘)"
    
    echo ""
    echo "簽退時間: $(format_time $CHECKOUT_HOUR $CHECKOUT_MINUTE)"
    
    # 計算並顯示簽退窗口
    local checkout_bounds=($(get_checkout_window))
    local checkout_start_time=$(printf "%02d:%02d" $((checkout_bounds[0] / 60)) $((checkout_bounds[0] % 60)))
    local checkout_end_time=$(printf "%02d:%02d" $((checkout_bounds[1] / 60)) $((checkout_bounds[1] % 60)))
    echo "簽退窗口: $checkout_start_time - $checkout_end_time (±${WINDOW_SIZE_MINUTES}分鐘)"
    
    echo ""
    echo -n "工作日: "
    for day in "${WORKDAYS[@]}"; do
        case $day in
            1) echo -n "週一 " ;;
            2) echo -n "週二 " ;;
            3) echo -n "週三 " ;;
            4) echo -n "週四 " ;;
            5) echo -n "週五 " ;;
            6) echo -n "週六 " ;;
            7) echo -n "週日 " ;;
        esac
    done
    echo
}

# 如果直接執行此配置文件，顯示當前配置
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    show_config
fi
